<!doctype html><html><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>Account — A.Production (of sorts)</title>
<link rel="stylesheet" href="/styles/base.css"><link rel="stylesheet" href="/styles/components.css">
</head><body><div class="container">
  <nav class="nav">
    <div class="row"><span class="badge">A.Production</span><span class="muted" style="margin-left:8px">(of sorts)</span></div>
    <div>
      <a href="/index.html" id="nav-home">Home</a>
      <a href="/services.html" id="nav-services">Services</a>
      <a href="/products.html" id="nav-products">Products</a>
      <a href="/account.html" id="nav-account">Account</a>
      <a href="/control-panel.html" id="nav-control">Control</a>
      <a href="/login.html" id="nav-login">Login</a>
      <a href="#" id="nav-logout">Logout</a>
    </div>
  </nav>

  <h1>Account</h1>
  <div id="me" class="muted"></div>

  <div class="card" style="margin-top:24px">
    <h3>Purchases & Access</h3>
    <div id="ent" class="grid cols-3"></div>
  </div>
</div>
<script type="module">
  import { wireNav } from '/scripts/nav.js';
  import { currentUser, api, money } from '/scripts/api.js';
  await wireNav('nav-account');
  const me = await currentUser();
  if (!me){ location.href='/login.html'; }
  document.getElementById('me').textContent = `${me.email} — role: ${me.role}`;
  const root = document.getElementById('ent');
  const items = await api('/me/entitlements');
  (items||[]).forEach(p=>{
    const wrap = document.createElement('div');
    wrap.className = 'card product';
    wrap.innerHTML = `
      <span class="badge">${(p.kind||'').toUpperCase()}</span>
      <h4>${p.title}</h4>
      <p class="muted">${p.description||''}</p>
      <div class="row" style="justify-content:space-between;align-items:end">
        <div class="price">${money(p.price_cents)}</div>
        <a class="button" href="${p.kind==='course'?`/product.html?id=${p.id}`:`/product.html?id=${p.id}`}">Open</a>
      </div>
    `;
    root.appendChild(wrap);
  });
</script>
</body></html>
