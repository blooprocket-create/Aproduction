<!doctype html><html><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>Account - A.Production (of sorts)</title>
<link rel="stylesheet" href="/styles/base.css"><link rel="stylesheet" href="/styles/components.css">

<script defer src="/_vercel/speed-insights/script.js"></script>
<script defer src="/_vercel/insights/script.js"></script>

</head><body>
  <div class="container">
    <nav class="nav" id="nav">
      <div class="brand">
        <span class="logo">
          <svg viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg">
            <defs>
              <linearGradient id="g1" x1="0" x2="1"><stop offset="0%" stop-color="#8a7cff"/><stop offset="100%" stop-color="#e45aff"/></linearGradient>
              <radialGradient id="g2" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#e45aff"/><stop offset="100%" stop-color="#8a7cff"/></radialGradient>
            </defs>
            <circle class="ring" cx="20" cy="20" r="14" />
            <circle class="dot" cx="28" cy="12" r="3"/>
          </svg>
        </span>
        <span class="badge">A.Production</span><span class="muted" style="margin-left:8px">(of sorts)</span>
      </div>
      <button class="nav-toggle" id="nav-toggle" aria-label="Menu"></button>
      <div class="nav-links" id="nav-links">
        <a href="/index.html" id="nav-home">Home</a>
        <a href="/services.html" id="nav-services">Services</a>
        <a href="/products.html" id="nav-products">Products</a>
        <a href="/account.html" id="nav-account">Account</a>
        <a href="/control-panel.html" id="nav-control">Control</a>
        <a href="/login.html" id="nav-login">Login</a>
        <a href="#" id="nav-logout">Logout</a>
      </div>
    </nav>
    <h1>Account</h1>
    <div id="me" class="muted"></div>
    <div class="card" style="margin-top:24px">
      <h3>Purchases & Access</h3>
      <div id="ent" class="grid cols-3"></div>
    </div>
    <div class="card" style="margin-top:24px" id="requests-card">
      <h3>My Service Requests</h3>
      <div id="requests-list" class="grid cols-3 hidden"></div>
      <p id="requests-empty" class="muted hidden">No service requests yet.</p>
    </div>
  </div>
<script type="module">
  import { currentUser, api, money, Service } from '/scripts/api.js';
  import { wireNav } from '/scripts/nav.js';

  await wireNav('nav-account');

  const me = await currentUser();
  if (!me) {
    location.href = '/login.html';
  }

  document.getElementById('me').textContent = `${me.email} - role: ${me.role}`;

  const entRoot = document.getElementById('ent');
  entRoot.innerHTML = '';
  const entitlements = await api('/me/entitlements');
  (entitlements || []).forEach((p) => {
    const wrap = document.createElement('div');
    wrap.className = 'card product';
    const href = p.kind === 'service' ? `/service.html?id=${p.id}` : `/product.html?id=${p.id}`;
    wrap.innerHTML = `
      <span class="badge">${(p.kind || '').toUpperCase()}</span>
      <h4>${p.title}</h4>
      <p class="muted">${p.description || ''}</p>
      <div class="row" style="justify-content:space-between;align-items:end">
        <div class="price">${money(p.price_cents)}</div>
        <a class="button" href="${href}">Open</a>
      </div>
    `;
    entRoot.appendChild(wrap);
  });

  const requestsList = document.getElementById('requests-list');
  const requestsEmpty = document.getElementById('requests-empty');
  requestsList.innerHTML = '';
  requestsList.classList.add('hidden');

  try {
    const requests = await Service.myRequests();
    if (!requests || requests.length === 0) {
      requestsEmpty.classList.remove('hidden');
    } else {
      requestsEmpty.classList.add('hidden');
      requestsList.classList.remove('hidden');
      requests.forEach((req) => {
        const card = document.createElement('div');
        card.className = 'card product';
        const href = `/service.html?id=${req.service_id}`;
        card.innerHTML = `
          <span class="badge">${(req.status || '').toUpperCase()}</span>
          <h4>${req.service_title || req.title}</h4>
          <p class="muted">${req.title}</p>
          <div class="row" style="justify-content:space-between;align-items:end">
            <div class="price">${req.price_cents != null ? money(req.price_cents) : '—'}</div>
            <a class="button ghost" href="${href}">View service</a>
          </div>
        `;
        requestsList.appendChild(card);
      });
    }
  } catch (error) {
    requestsEmpty.textContent = error.message || 'Unable to load requests.';
    requestsEmpty.classList.remove('hidden');
  }
</script>
<script type="module" src="/scripts/nav.js"></script>
</body></html>
