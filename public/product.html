<!doctype html><html lang="en"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>Product â€” A.Production (of sorts)</title>
<link rel="stylesheet" href="/styles/base.css"><link rel="stylesheet" href="/styles/components.css">
</head><body><div class="container">
  <nav class="nav">
    <div class="row"><span class="badge">A.Production</span><span class="muted" style="margin-left:8px">(of sorts)</span></div>
    <div>
      <a href="/index.html" id="nav-home">Home</a>
      <a href="/services.html" id="nav-services">Services</a>
      <a href="/products.html" id="nav-products">Products</a>
      <a href="/account.html" id="nav-account">Account</a>
      <a href="/control-panel.html" id="nav-control">Control</a>
      <a href="/login.html" id="nav-login">Login</a>
      <a href="#" id="nav-logout">Logout</a>
    </div>
  </nav>
  <div id="content" class="grid">
    <div class="card product" id="detail"></div>
    <button class="button" id="buy">Buy Now</button>
  </div>
</div>
<script type="module">
  import { api, money, currentUser } from '/scripts/api.js';
  import { wireNav } from '/scripts/nav.js';
  await wireNav('nav-products');
  const id = new URLSearchParams(location.search).get('id');
  const me = await currentUser();
  let p = null;
  try{ p = await api('/products/'+id); }catch(e){ alert(e.message); }
  if(p){
    const d = document.getElementById('detail');
    d.innerHTML = `
      <span class="badge">${(p.kind||'PRODUCT').toUpperCase()}</span>
      <h1>${p.title}</h1>
      <p class="muted">${p.description||''}</p>
      <div class="price">${money(p.price_cents)}</div>
      ${me && ['admin','editor'].includes(me.role) ? `<a class='edit-pill' href='/edit.html?id=${p.id}&k=product'>Edit</a>` : ''}
    `;
    document.getElementById('buy').onclick = async ()=>{
      try{ await api('/orders', { method:'POST', body: JSON.stringify({ product_id: id, qty:1 }) }); location.href='/account.html'; }
      catch(e){ alert(e.message); }
    };
  }
</script>
</body></html>
