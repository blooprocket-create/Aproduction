<!doctype html><html lang="en"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>Course — A.Production (of sorts)</title>
<link rel="stylesheet" href="/styles/base.css"><link rel="stylesheet" href="/styles/components.css">
<script defer src="/_vercel/speed-insights/script.js"></script>
<script defer src="/_vercel/insights/script.js"></script>
</head><body><div class="container">
  <nav class="nav" id="nav">
    <div class="brand">
      <span class="logo">
        <svg viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <linearGradient id="g1" x1="0" x2="1"><stop offset="0%" stop-color="#8a7cff"/><stop offset="100%" stop-color="#e45aff"/></linearGradient>
            <radialGradient id="g2" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#e45aff"/><stop offset="100%" stop-color="#8a7cff"/></radialGradient>
          </defs>
          <circle class="ring" cx="20" cy="20" r="14" />
          <circle class="dot" cx="28" cy="12" r="3"/>
        </svg>
      </span>
      <span class="badge">A.Production</span><span class="muted" style="margin-left:8px">(of sorts)</span>
    </div>
    <button class="nav-toggle" id="nav-toggle" aria-label="Menu"></button>
    <div class="nav-links" id="nav-links">
      <a href="/index.html" id="nav-home">Home</a>
      <a href="/services.html" id="nav-services">Services</a>
      <a href="/products.html" id="nav-products">Products</a>
      <a href="/account.html" id="nav-account">Account</a>
      <a href="/control-panel.html" id="nav-control">Control</a>
      <a href="/login.html" id="nav-login">Login</a>
      <a href="#" id="nav-logout">Logout</a>
    </div>
  </nav>

  <div class="grid" id="wrap">
    <div class="card" id="player">
      <div id="embed" class="muted">Loading video…</div>
    </div>
    <div class="card" id="playlist">
      <h3>Lessons</h3>
      <div id="list" class="grid"></div>
    </div>
  </div>
</div>
<script type="module">
  import { api } from '/scripts/api.js';
  import { wireNav } from '/scripts/nav.js';
  await wireNav('nav-products');
  const productId = new URLSearchParams(location.search).get('id');
  let c = null;
  try{ c = await api('/courses/'+productId); }catch(e){ alert(e.message); location.href='/product.html?id='+productId; }
  if (!c) return;

  const list = document.getElementById('list');
  const embed = document.getElementById('embed');

  function play(v){
    if (!v.video_url){
      embed.innerHTML = '<div class="muted">Locked. Enroll to watch.</div>';
      return;
    }
    const url = v.video_url.replace('watch?v=','embed/');
    embed.innerHTML = '<div style="position:relative;padding-top:56.25%"><iframe src="'+url+'" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen style="position:absolute;inset:0;width:100%;height:100%"></iframe></div>';
  }

  (c.videos||[]).forEach(v => {
    const row = document.createElement('div');
    row.className = 'row' + (v.video_url ? '' : ' item-locked');
    row.style.justifyContent = 'space-between';
    row.innerHTML = `<div>${v.title}</div><div class="muted">${Math.round((v.duration_seconds||0)/60)}m ${v.free_preview?'<span class="pill">Preview</span>':''}</div>`;
    row.onclick = ()=> play(v);
    list.appendChild(row);
  });

  const firstPlayable = (c.videos||[]).find(v => v.video_url) || c.videos?.[0];
  if (firstPlayable) play(firstPlayable);
</script>
<script type="module" src="/scripts/nav.js"></script>
</body></html>
