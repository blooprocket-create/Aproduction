<!doctype html><html><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>Edit - A.Production (of sorts)</title>
<link rel="stylesheet" href="/styles/base.css"><link rel="stylesheet" href="/styles/components.css">
</head><body><div class="container">
  <nav class="nav">
    <div class="row"><span class="badge">A.Production</span><span class="muted" style="margin-left:8px">(of sorts)</span></div>
    <div>
      <a href="/index.html" id="nav-home">Home</a>
      <a href="/services.html" id="nav-services">Services</a>
      <a href="/products.html" id="nav-products">Products</a>
      <a href="/account.html" id="nav-account">Account</a>
      <a href="/control-panel.html" id="nav-control">Control</a>
      <a href="/login.html" id="nav-login">Login</a>
      <a href="#" id="nav-logout">Logout</a>
    </div>
  </nav>

  <h1>Edit Item</h1>
  <form id="f" class="grid" style="max-width:640px">
    <input class="input" name="title" placeholder="title">
    <input class="input" name="slug" placeholder="slug">
    <textarea class="input" name="description" placeholder="description"></textarea>
    <input class="input" name="price" type="number" min="0" step="0.01" placeholder="price in USD">
    <label><input type="checkbox" name="published"> Published</label>
    <button class="button" type="submit">Save</button>
    <p id="msg" class="muted" role="alert"></p>
  </form>
</div>
<script type="module">
  import { wireNav } from '/scripts/nav.js';
  import { Auth, api } from '/scripts/api.js';
  await wireNav();
  const me = await Auth.me();
  if (!['admin','editor'].includes(me.role)) location.href = '/';

  const params = new URLSearchParams(location.search);
  const id = params.get('id');
  const isService = params.get('k') === 'service';
  const base = isService ? '/services' : '/products';
  const item = await api(`${base}/${id}`);

  const form = document.getElementById('f');
  const msg = document.getElementById('msg');
  form.title.value = item.title || '';
  form.slug.value = item.slug || '';
  form.description.value = item.description || '';
  form.price.value = (item.price_cents || 0) / 100;
  form.published.checked = !!item.published;

  form.onsubmit = async (event) => {
    event.preventDefault();
    msg.textContent = '';
    const payload = {};
    if (form.title.value) payload.title = form.title.value;
    if (form.slug.value) payload.slug = form.slug.value;
    if (form.description.value) payload.description = form.description.value;
    if (form.price.value) payload.price_cents = Math.round(Number(form.price.value || 0) * 100);
    payload.published = form.published.checked;
    try {
      await api(`${base}/${id}`, { method: 'PATCH', body: JSON.stringify(payload) });
      msg.textContent = 'Saved';
    } catch (error) {
      msg.textContent = error.message || 'Save failed';
    }
  };
</script>
</body></html>
